<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>uni-app框架开发小程序踩坑总结 | Fog3211</title>
    <meta name="description" content="uni-app框架开发小程序踩坑总结">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    <meta name="keywords" content="uni-app, 小程序">
    <link rel="preload" href="/assets/css/0.styles.cdd2a29b.css" as="style"><link rel="preload" href="/assets/js/app.20bb5225.js" as="script"><link rel="preload" href="/assets/js/50.7d5dfb82.js" as="script"><link rel="prefetch" href="/assets/js/10.8a9c4f08.js"><link rel="prefetch" href="/assets/js/11.8783f7cc.js"><link rel="prefetch" href="/assets/js/12.5ba97642.js"><link rel="prefetch" href="/assets/js/13.1555b7ad.js"><link rel="prefetch" href="/assets/js/14.86f2088d.js"><link rel="prefetch" href="/assets/js/15.fe266707.js"><link rel="prefetch" href="/assets/js/16.15fb79aa.js"><link rel="prefetch" href="/assets/js/17.1a463419.js"><link rel="prefetch" href="/assets/js/18.7c246c5a.js"><link rel="prefetch" href="/assets/js/19.61ef187a.js"><link rel="prefetch" href="/assets/js/2.81a45b37.js"><link rel="prefetch" href="/assets/js/20.7a9b2f72.js"><link rel="prefetch" href="/assets/js/21.b4f5ca00.js"><link rel="prefetch" href="/assets/js/22.3f4573be.js"><link rel="prefetch" href="/assets/js/23.e2af9378.js"><link rel="prefetch" href="/assets/js/24.785952aa.js"><link rel="prefetch" href="/assets/js/25.7ae5ad53.js"><link rel="prefetch" href="/assets/js/26.36e42edb.js"><link rel="prefetch" href="/assets/js/27.3409191d.js"><link rel="prefetch" href="/assets/js/28.393153e4.js"><link rel="prefetch" href="/assets/js/29.dfc25383.js"><link rel="prefetch" href="/assets/js/3.c6d0cc46.js"><link rel="prefetch" href="/assets/js/30.71df5033.js"><link rel="prefetch" href="/assets/js/31.df5404b7.js"><link rel="prefetch" href="/assets/js/32.f1e5ef7c.js"><link rel="prefetch" href="/assets/js/33.3a7e0b72.js"><link rel="prefetch" href="/assets/js/34.bad16bb7.js"><link rel="prefetch" href="/assets/js/35.70e4cf71.js"><link rel="prefetch" href="/assets/js/36.121c4657.js"><link rel="prefetch" href="/assets/js/37.bf6ac364.js"><link rel="prefetch" href="/assets/js/38.fc37e97c.js"><link rel="prefetch" href="/assets/js/39.d04e3ead.js"><link rel="prefetch" href="/assets/js/4.bc59a004.js"><link rel="prefetch" href="/assets/js/40.6a269460.js"><link rel="prefetch" href="/assets/js/41.2ac7fb97.js"><link rel="prefetch" href="/assets/js/42.73ab3bd7.js"><link rel="prefetch" href="/assets/js/43.f9273bf5.js"><link rel="prefetch" href="/assets/js/44.0ea4214a.js"><link rel="prefetch" href="/assets/js/45.eb95c47a.js"><link rel="prefetch" href="/assets/js/46.e5a1623a.js"><link rel="prefetch" href="/assets/js/47.3ae1611c.js"><link rel="prefetch" href="/assets/js/48.da7834c4.js"><link rel="prefetch" href="/assets/js/49.cf1add44.js"><link rel="prefetch" href="/assets/js/5.1cecc36c.js"><link rel="prefetch" href="/assets/js/51.16da791b.js"><link rel="prefetch" href="/assets/js/52.23ddb970.js"><link rel="prefetch" href="/assets/js/53.2de2eea4.js"><link rel="prefetch" href="/assets/js/54.c02fc9ea.js"><link rel="prefetch" href="/assets/js/55.b391fb5b.js"><link rel="prefetch" href="/assets/js/56.0c72f5c7.js"><link rel="prefetch" href="/assets/js/57.22a17b28.js"><link rel="prefetch" href="/assets/js/58.533c918b.js"><link rel="prefetch" href="/assets/js/59.96ac7904.js"><link rel="prefetch" href="/assets/js/6.7fdb8414.js"><link rel="prefetch" href="/assets/js/60.4e089b8c.js"><link rel="prefetch" href="/assets/js/61.7b17150b.js"><link rel="prefetch" href="/assets/js/62.937e58de.js"><link rel="prefetch" href="/assets/js/63.cb70c672.js"><link rel="prefetch" href="/assets/js/7.f5fab6ae.js"><link rel="prefetch" href="/assets/js/8.770acd1e.js"><link rel="prefetch" href="/assets/js/9.93643764.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cdd2a29b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.png" class="logo"> <span class="site-name can-hide">
        Fog3211
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/resume/" class="nav-link">简历</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="https://github.com/fog3211" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/resume/" class="nav-link">简历</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="https://github.com/fog3211" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><h1 class="page-title">
        uni-app框架开发小程序踩坑总结
      </h1> <span class="page-timestamp">2019-08-17 19:27:13</span></div> <div class="content"><p>本文用来记录使用uni-app框架开发小程序的踩过的坑。
</p> <h2 id="介绍"><a href="#介绍" aria-hidden="true" class="header-anchor">#</a> 介绍</h2> <p>    入职时公司有组织实习生进行合作开发项目的活动，而我作为其中的一员也是参与了进来，项目的讨论结果是做要一个小程序，但对于我这个不怎么接触小程序的菜鸡来说还是希望使用vue来进行开发（之前有用过mpvue），偶然间发现了<a href="https://uniapp.dcloud.io/" target="_blank" rel="noopener noreferrer">uni-app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>框架，遂拿来练手玩一下。</p> <h2 id="正文"><a href="#正文" aria-hidden="true" class="header-anchor">#</a> 正文</h2> <h3 id="自定义tabbar"><a href="#自定义tabbar" aria-hidden="true" class="header-anchor">#</a> 自定义tabbar</h3> <p>首先看一下效果展示：</p> <p><img src="https://img.fog3211.com/N0Y8OI%25_7SDA$MZVY3U5XL.gif" alt="avatar"></p> <p>    这里要先讲下为什么做自定义的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/custom-tabbar.html" target="_blank" rel="noopener noreferrer">tab-bar<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,其实在gif里面也可以猜到一些了，我们的功能需要导航栏做两个档位的切换，这在小程序提供的原生组件中是不可能实现的，所以只能自己来做（这里主要参考<a href="https://github.com/weilanwl/ColorUI" target="_blank" rel="noopener noreferrer">colorUI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的demo）。</p> <p>思路大致如下：</p> <p>首先需要一个index.vue做主页面（相当于APP.vue的作用），然后里面注入导航栏需要展示的页面组件，然后通过<code>v-if</code>（这里v-show无效）判断当前路径来进行页面的显示隐藏。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'chat'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>home</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'home'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>home</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mine</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'mine'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mine</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tab-bar</span> <span class="token attr-name">@childFn</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>parentFn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tab-bar</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			PageCur<span class="token punctuation">:</span> <span class="token string">'chat'</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		<span class="token function">parentFn</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>PageCur <span class="token operator">=</span> e <span class="token operator">||</span> <span class="token string">'home'</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>


</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> home <span class="token keyword">from</span> <span class="token string">'./pages/home/home.vue'</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">,</span> home<span class="token punctuation">)</span>

<span class="token keyword">import</span> chat <span class="token keyword">from</span> <span class="token string">'./pages/chat/chat.vue'</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'chat'</span><span class="token punctuation">,</span> chat<span class="token punctuation">)</span>

<span class="token keyword">import</span> mine <span class="token keyword">from</span> <span class="token string">'./pages/mine/mine.vue'</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'mine'</span><span class="token punctuation">,</span> mine<span class="token punctuation">)</span>

<span class="token keyword">import</span> tabBar <span class="token keyword">from</span> <span class="token string">'./components/tab-bar/tab-bar.vue'</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'tab-bar'</span><span class="token punctuation">,</span> tabBar<span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- tab-bar.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cu-bar tabbar bg-white shadow foot<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tabbar_state<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'chat' ? 'tabbar-with-toggle' : ''<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>action toggle-box<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.native.stop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>toggleTabBarState<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'chat'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>../../static/icon/toggle.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>NavChange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-cur</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>chat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cuIcon-cu-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>/static/tabbar/chat' + [PageCur == 'chat' ? '_cur' : ''] + '.png'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'chat' ? 'text-blue' : 'text-gray'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>NavChange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-cur</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cuIcon-cu-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>/static/tabbar/home' + [PageCur == 'home' ? '_cur' : ''] + '.png'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'home' ? 'text-blue' : 'text-gray'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>小鹊讲堂<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>NavChange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-cur</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mine<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cuIcon-cu-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>/static/tabbar/mine' + [PageCur == 'mine' ? '_cur' : ''] + '.png'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PageCur == 'mine' ? 'text-blue' : 'text-gray'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>我的<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			PageCur<span class="token punctuation">:</span> <span class="token string">'chat'</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	computed<span class="token punctuation">:</span> <span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'tabbar_state'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		<span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'toggleTabBarState'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function-variable function">NavChange</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>PageCur <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>cur<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'childFn'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scss<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.tabbar</span> <span class="token punctuation">{</span>
	<span class="token selector">&amp;-with-toggle</span> <span class="token punctuation">{</span>
		<span class="token property">padding-left</span><span class="token punctuation">:</span> 80upx<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token selector">.toggle-box</span> <span class="token punctuation">{</span>
		<span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
		<span class="token property">width</span><span class="token punctuation">:</span> 12%<span class="token punctuation">;</span>
		<span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
		<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
		<span class="token property">z-index</span><span class="token punctuation">:</span> 9999<span class="token punctuation">;</span>
		<span class="token property">border-right</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token selector">;
		.toggle</span> <span class="token punctuation">{</span>
			<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
			<span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
			<span class="token property">left</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span>
			<span class="token property">width</span><span class="token punctuation">:</span> 70%<span class="token punctuation">;</span>
			<span class="token property">height</span><span class="token punctuation">:</span> 60%<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>    以上是主要代码，我用了vuex来进行导航栏状态的存储，正常的自定义<code>tab-bar</code>是不需要的。</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>这里其实并不是很推荐自定义的<code>tab-bar</code>，主要是因为里面有个很尴尬的坑：<br>
    通过这种方式自定义导航栏后会失去大部分的生命周期(如<code>onShow</code>,<code>onLoad</code>)，能用的好像只剩<code>onReady</code>了。</p> <p>我的理解大概是这样的：</p> <ol><li><p><code>onShow</code>是页面从低一级到高一级出来的情况才会触发，但是这里通过<code>v-if</code>控制显隐实际上就只有一层页面，所以<code>onShow</code>无效。</p></li> <li><p><code>onLoad</code>相当于vue里面的<code>created</code>，监听页面加载，只有navigateTo或navigateBack进入才会触发，但<code>v-if</code>不会触发。</p></li> <li><p><code>onReady</code>相当于vue里面的<code>mounted</code>，每次<code>v-if</code>切换时都会进行节点的重新挂载（事实上是重新生成的新的节点），所以会触发。</p></li></ol></div> <h3 id="视频组件轮播"><a href="#视频组件轮播" aria-hidden="true" class="header-anchor">#</a> 视频组件轮播</h3> <p>    对于小程序里面的视频轮播(实际上是视频+图片轮播)，这里面也有个小坑。</p> <p>    由于视频组件作为原生组件，因此层级最高且无法修改，因此当视频和图片一起轮播时，就会出现切换到图片在最顶层时，视频依旧保留在最上方的现象（不过好像PC模拟器看不出来，只有真机调试才会有问题）。</p> <p>解决方法：为每一个轮播视频新增一个图片，并在轮播未切换时全部以图片方式展示，当切换到视频的时候，<code>v-if</code>隐藏图片，展示视频即可。</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>这里需要注意的是，视频需要设置<code>autoplay</code>自动播放属性,关闭<code>controls</code>属性,不然切换之后再点击开始不会播放视频（猜测是和轮播有冲突）。</p></div> <h3 id="web-view使用"><a href="#web-view使用" aria-hidden="true" class="header-anchor">#</a> web-view使用</h3> <p>    对于要在小程序里展示其他外链页面的需求，可以借助<code>web-view</code>来实现，这里的<code>web-view</code>是直接加载路径里面的页面并且自动扩充为全屏，所以要是做跳转的话还是作为子组件并设置默认值为空，需要跳转的时候在赋值即可。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-view</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			url<span class="token punctuation">:</span> <span class="token string">''</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		<span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 获取页面参数</span>
			<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>$mp<span class="token punctuation">.</span>query<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
			<span class="token comment">// console.log(&quot;文章地址为： &quot;+url);</span>

			<span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 这里的onShow是跳转后的二级页面，所以可用</span>
	<span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scss<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>这里需要注意的是，如果跳转的外链带有?或&amp;的参数，可能会出现跳转错误的问题。所以对外链需要进行js字符串的简单加密解密。
如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 加密字符串</span>
<span class="token keyword">const</span> <span class="token function-variable function">compileStr</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> c <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> code<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> code<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		c <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> code<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">escape</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 解密字符串</span>
<span class="token keyword">const</span> <span class="token function-variable function">uncompileStr</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	code <span class="token operator">=</span> <span class="token function">unescape</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> c <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> code<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> code<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		c <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> c<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>    这里要先吐槽一下<code>uni-app</code>，使用<code>uni-app</code>基本上要使用其绑定的编辑器——<code>HBuilderX</code>（巨难用，虽然好像使用其他编辑器装插件也可以用，但真的不喜欢hbuilder），不像<code>mpvue</code>比较自由一些。</p> <p>    不过话说回来，<code>uni-app</code>的生态确实没的说，大部分的坑都是别人踩过的，各种插件，demo也比较齐全，很容易上手，1端代码6端运行也是很省事的（虽然我只做到了兼容了H5和微信小程序）。</p> <p>    最后附上自己的<a href="https://github.com/fog3211/pica-miniapp" target="_blank" rel="noopener noreferrer">成果<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（后端部署在了公司的内网上,所以。。。）</p></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/blog/use-nrm.html" class="prev">
            nrm——更强大的npm源管理工具使用总结
          </a></span> <span class="next"><a href="/blog/css-clip-path.html">
            解密CSS3新属性——clip-path
          </a> →
        </span></p></div></div> <div id="comment-container"><div class="gt-container"><div class="gt-initing"><i class="gt-loader"></i> <p class="gt-initing-text">Gitalking ...</p></div> <!----> <!----> <div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span> <!----></span></a> <div class="gt-header-comment"><textarea placeholder="Leave a comment" class="gt-header-textarea"></textarea> <div class="gt-header-preview markdown-body hide"></div> <div class="gt-header-controls"><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" class="gt-header-controls-tip"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z"
    p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z"
    p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z"
    p-id="3085"></path>
</svg>
</span> <span class="gt-ico-text">Markdown is supported</span></span></a> <!----> <button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span> <!----></button> <button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span> <!----></button></div></div></div> <div class="gt-comments"><span></span> <p class="gt-comments-null">
                Be the first guy leaving a comment!
            </p> <!----></div></div></div></div></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:#f6f6f6;"></div></div></div>
    <script src="/assets/js/app.20bb5225.js" defer></script><script src="/assets/js/50.7d5dfb82.js" defer></script>
  </body>
</html>

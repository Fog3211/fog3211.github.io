(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{277:function(t,s,e){"use strict";e.r(s);var r=e(1),n=Object(r.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[e("p",[t._v("本文将介绍如何配置nginx代理https和wss。\n")]),t._v(" "),t._m(0),t._v(" "),e("p",[t._v("   前几天做了一个websocket聊天室("),e("a",{attrs:{href:"https://chatroom.fog3211.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("传送门"),e("OutboundLink")],1),t._v(")，自己在本地跑着都没什么问题，然而一上线就报错，最后用nginx反向代理https和wss解决了问题，特此记录一下踩坑过程。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),e("p",[t._v("   本以为这样就OK了，然而登录注册页面解决了https问题后，聊天页面又报了新的错误。")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),e("p",[t._v("解决方式如下")]),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._v(" "),e("p",[t._v("   经过各种踩坑，终于解决了websocket使用wss协议通讯的问题，当然有些地方还有很多小细节需要处理，nginx的配置需要具体问题具体对待。")])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍","aria-hidden":"true"}},[this._v("#")]),this._v(" 介绍")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"http-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-https","aria-hidden":"true"}},[this._v("#")]),this._v(" http => https")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("首先是登录注册功能，由于在本地使用的是axios请求localhost的后端代码，如下所示\n"),s("img",{attrs:{src:"https://img.fog3211.com/41%5DB19%28OEE8%5DS3Y%25%5DX%254%60%29U.png",alt:"avatar"}}),s("br"),this._v("\n鉴于https协议更加安全，上线后就改用了https协议。"),s("br"),this._v("\n把请求用到的http协议换为https，并在nginx.conf中添加")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("    # HTTPS server\n  \n    server {\n            listen       443 ssl;\n             #对应主机名\n            server_name  chatroom.fog3211.com;\n\n            #对应SSL证书的目录\n            ssl_certificate      ../cert/chatroom/https.crt;\n            ssl_certificate_key  ../cert/chatroom/https.key;\n\n            #ssl_session_cache    shared:SSL:1m;\n            ssl_session_timeout  5m;\n\n            #ssl_ciphers  HIGH:!aNULL:!MD5;\n            #ssl_prefer_server_ciphers  on;\n\n            location / {\n              #主页页面目录\n              root   projects/web-chatroom/dist/;\n              index  index.html index.htm;\n            }\n        }\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"ws-wss"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ws-wss","aria-hidden":"true"}},[this._v("#")]),this._v(" ws => wss")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://img.fog3211.com/O%7B_7%5B2AL__TR40~B%28$X%29C%28Y.png",alt:"avatar"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("   大体意思就是浏览器会block掉连接，和https下不允许http请求一样；其实也比较这一点好理解，因为websocket的ws协议(下图)使用80端口另外还有一个叫wss的协议对应443端口，可以类比http和https作参考。因为前面请求后端用的的是https协议，而这里用的是ws协议（大致等同于http协议），浏览器自然就会报错了。"),s("br"),this._v(" "),s("img",{attrs:{src:"https://img.fog3211.com/803%28KLWAWDZMVOXZWUZL%5DSB.png",alt:"avatar"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一般我们都会想到直接把ws协议换为wss协议"),s("br"),this._v(" "),s("img",{attrs:{src:"https://img.fog3211.com/%5BR~HQ~_%7D%25T~G@O~0KX%5BFG2Y.png",alt:"avatar"}}),this._v("\n    改了之后又出了新的错误(当然有的报错和我的不一样，在网上找相关资料有些错误我还没遇到过)"),s("br"),this._v(" "),s("img",{attrs:{src:"https://img.fog3211.com/T%5B7D150Q7LEP%25LDC21CTHNX.png",alt:"avatar"}}),this._v("\n看了别人的博客说是因为证书问题")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v('#在HTTPS server后面添加  \n\nlocation /websocket {\n    proxy_pass http://backend;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";\n}\n\n')])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),s("p",[this._v("注意proxy_pass后面是对应的后端地址 "),s("code",[this._v("http://backend")]),this._v(" 不要忘了改成自己的。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])}],!1,null,null,null);s.default=n.exports}}]);